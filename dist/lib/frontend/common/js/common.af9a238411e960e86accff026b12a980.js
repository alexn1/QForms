class FrontHostApp{constructor(){this.alertCtrl=null,window.addEventListener("error",this.onWindowError.bind(this)),window.addEventListener("unhandledrejection",this.onWindowUnhandledrejection.bind(this)),window.addEventListener("popstate",this.onWindowPopState.bind(this))}async run(){throw new Error("FrontHostApp.run not implemented")}async onWindowUnhandledrejection(t){console.log("FrontHostApp.onWindowUnhandledrejection");try{t.preventDefault();var e=t instanceof Error?t:t.reason||t.detail.reason;this.logError(e),await this.alert({title:"Unhandled Rejection",message:e.message})}catch(t){console.error("onWindowUnhandledrejection error: "+t.message)}}async onWindowError(t){console.log("FrontHostApp.onWindowError",t);try{t.preventDefault();var e=t.error;this.logError(e)}catch(t){console.error("onWindowError error: "+t.message)}}logError(t){console.error("FrontHostApp.logError",t);t={type:"error",source:"client",message:t.message,stack:t.stack,data:{href:window.location.href,platformVersion:this.getData().versions.platform,appVersion:this.getData().versions.app}};console.log("POST "+this.getData().logErrorUrl,t),fetch(this.getData().logErrorUrl,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)}).catch(t=>{console.error(t.message)})}getData(){if(!this.options.data)throw new Error("no data");return this.options.data}static async doHttpRequest(t){console.warn("FrontHostApp.doHttpRequest","POST",window.location.href,t);var[,e]=await FrontHostApp.postJson(window.location.href,t);return console.warn(`body ${t.page}.${t.form}.${t.ds||t.name}.${t.action}:`,e),e}static async doHttpRequest2(t){console.warn("FrontHostApp.doHttpRequest2","POST",window.location.href,t);var[e,o]=await FrontHostApp.postJson(window.location.href,t);return console.warn(`body ${t.page}.${t.form}.${t.ds||t.name}.${t.action}:`,o),[e,o]}static async postJson(t,e){return FrontHostApp.post(t,JSON.stringify(e),"application/json;charset=utf-8")}static async post(t,e,o){try{FrontHostApp.startWait();const n=await fetch(t,{method:"POST",body:e,...o?{headers:{"Content-Type":o}}:{}});if(n.ok){var r=Array.from(n.headers.entries()).reduce((t,e)=>{var[o,e]=e;return t[o]=e,t},{});const e=await n.json();return[r,e]}throw new Error(`${n.status} ${n.statusText}: `+await n.text())}finally{FrontHostApp.stopWait()}}static startWait(){document.querySelector("html").classList.add("wait")}static stopWait(){document.querySelector("html").classList.remove("wait")}static getClassByName(className){return"function"===eval("typeof "+className)?eval(className):null}async onWindowPopState(t){console.log("FrontHostApp.onWindowPopState",t.state)}alert(n){return console.log("FrontHostApp.alert",n),new Promise((e,o)=>{try{const r=document.querySelector(".alert-root");if(0===r.childElementCount){const t=this.alertCtrl=new AlertController({...n,onClose:t=>{this.alertCtrl=null,ReactDOM.unmountComponentAtNode(r),e(t)}});Helper.createReactComponent(r,t.getViewClass(),{ctrl:t})}else o(new Error("alert already exists"))}catch(t){o(t)}})}confirm(n){return console.log("FrontHostApp.confirm",n),new Promise((e,o)=>{try{const r=document.querySelector(".alert-root");if(0===r.childElementCount){const t=this.alertCtrl=new ConfirmController({...n,onClose:t=>{this.alertCtrl=null,ReactDOM.unmountComponentAtNode(r),e(t)}});Helper.createReactComponent(r,t.getViewClass(),{ctrl:t})}else o(new Error("confirm already exists"))}catch(t){o(t)}})}}window.QForms.FrontHostApp=FrontHostApp;class Helper{static formatDate(t,e){var o=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),a=t.getHours(),s=t.getMinutes(),t=t.getSeconds();const i={YYYY:o,M:r,D:n,h:a,m:s,s:t,MM:r<10?"0"+r:r,DD:n<10?"0"+n:n,hh:a<10?"0"+a:a,mm:s<10?"0"+s:s,ss:t<10?"0"+t:t};return e.replace(/\{([\w\.]+)\}/g,(t,e)=>i[e]||t)}static formatNumber(t){return new Intl.NumberFormat("ru-RU").format(t)}static today(){var t=new Date;return Helper.getStartOfDay(t)}static getStartOfDay(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}static encodeObject(t){const e={};for(const o in t)e[o]=Helper.encodeValue(t[o]);return e}static encodeValue(t){return JSON.stringify(t)}static decodeObject(t){if(!t)throw new Error("Helper.decodeObject: no object");const e={};for(const o in t)e[o]=Helper.decodeValue(t[o]);return e}static decodeValue(e){try{return JSON.parse(e,Helper.dateTimeReviver)}catch(t){throw console.log("raw:",e),t}}static dateTimeReviver(t,e){if("string"==typeof e&&/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d{3})?(Z|([+-])(\d{2}):(\d{2}))?$/.exec(e))return new Date(e);return e}static createReactComponent(t,e,o={},r){let n;o.onCreate=t=>n=t;r=React.createElement(e,o,r);return ReactDOM.render(r,t),n}static destroyReactComponent(t){ReactDOM.unmountComponentAtNode(t)}static readFileAsDataURL(o){return new Promise(t=>{const e=new FileReader;e.onload=()=>t(e.result),e.readAsDataURL(o)})}static templateToJsString(t,o){return t.replace(/\$\{([\w\.@]+)\}/g,(t,e)=>o.hasOwnProperty(e)?`Helper.decodeValue('${Helper.encodeValue(o[e])}')`:"undefined")}static moveArrItem(t,e,o){e=t.indexOf(e);if(-1===e)throw new Error("cannot find element");o=e+o;if(o<0)throw new Error("cannot up top element");if(o>t.length-1)throw new Error("cannot down bottom element");t.splice(o,0,t.splice(e,1)[0])}static formatTime(t){let e=t,o="";t<0&&(e=-e,o="-");let r=Math.floor(e/3600),n=Math.floor((e-3600*r)/60),a=Math.floor(e-3600*r-60*n);return r<10&&(r="0"+r),n<10&&(n="0"+n),a<10&&(a="0"+a),0===r?""+o+n+":"+a:""+o+r+`:${n}:`+a}static SECOND(){return 1e3}static MINUTE(){return 60*Helper.SECOND()}static HOUR(){return 60*Helper.MINUTE()}static DAY(){return 24*Helper.HOUR()}static fallbackCopyTextToClipboard(t){const e=document.activeElement,o=document.createElement("textarea");o.value=t,o.style.top="0",o.style.left="0",o.style.position="fixed",document.body.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),document.body.removeChild(o),e.focus()}static async copyTextToClipboard(t){console.log("Helper.copyTextToClipboard",t),navigator.clipboard?await navigator.clipboard.writeText(t):Helper.fallbackCopyTextToClipboard(t)}static addMinutes(t,e){t.setMinutes(t.getMinutes()+e)}static fillArray(t){return Array.from(Array(t).keys())}}window.QForms.Helper=Helper;
//# sourceMappingURL=common.af9a238411e960e86accff026b12a980.js.map

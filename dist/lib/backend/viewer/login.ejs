<!DOCTYPE html>
<html class="login" lang="<%=application.getAttr('lang')%>">
<head>
    <!-- qforms v<%=version%> -->
    <!-- app v<%=application.getVersion()%>  -->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%=application.getTitle(context)%> - <%=application.getText().login.login%></title>
    <!-- links -->
    <%links.forEach(link => {
        if (typeof link === 'string') {
            %><link rel="stylesheet" href="<%=link%>"/>
        <%
        } else if (typeof link === 'object') {
            %><link rel="<%=link.rel%>" href="<%=link.href%>" <%=link.crossorigin === true ? 'crossorigin' : ''%>/>
        <%
        }
    });%>
    <!-- scripts -->
    <%scripts.forEach(src => {
        %><script type="text/javascript" src="<%=src%>"></script>
    <%
    });%>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const data = JSON.parse(document.querySelector('script[type="application/json"]').textContent);
            const frontHostApp = new LoginFrontHostApp(data);
            await frontHostApp.run();


            document.querySelector('.login__form').addEventListener('submit', async e => {
                document.querySelector('.login__button').disabled = true;
                document.querySelector('input[name=tzOffset]').setAttribute(
                    'value',
                    JSON.stringify(new Date().getTimezoneOffset())
                );
                // e.preventDefault();
            });
        });
    </script>
    <script type="application/json"><%- JSON.stringify(data, null, 4) %></script>
</head>
<body class="login__body">
    <div class="login__root"></div>
    <!--
    <form class="login__form" action="<%=REQUEST_URI%>" method="post">
        <input name="tzOffset" type="hidden">
        <input name="action" type="hidden" value="login">
        <% if (users) { %>
            <select name="username" required autofocus>
                <option value=""></option>
                <% users.forEach((user) => { %>
                <option value="<%=user.username%>" <%=user.username === username ? 'selected' : ''%>><%=user.title%></option>
                <% }); %>
            </select>
        <% } else { %>
        <div class="login__title"><%=application.getTitle(context)%></div>
        <input class="login__field" name="username" placeholder="<%=application.getText().login.username%>" required autofocus value="<%=username%>" spellcheck="false">
        <% } %>
        <input class="login__field" name="password" type="password" placeholder="<%=application.getText().login.password%>">
        <% if (errMsg !== null) { %>
            <p class="login__err-msg"><%=errMsg%></p>
        <% } %>
        <button class="login__button" type="submit"><%=application.getText().login.signIn%></button>
    </form>
    -->
</body>
</html>
